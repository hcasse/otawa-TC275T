<?xml version="1.0" encoding="UTF-8"?>

<!-- pipeline TC 1.6P /-->

<processor class="otawa::hard::Processor"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

	<arch>tricore</arch>
	<model>tc275T</model>
	<frequency>200000000</frequency>	<!-- 300 Mhz -->
	
	<!-- timing:
			* fetch (1.6P, 1.6E)
				Instruction Protection		Fetch
				PC Unit						Align
					\						/
							Issue Unit
			* pipelines (1.6P)
				IP Decode		LS Decode		Loop Decode
				- - - - - - - - - - - - - - - - - - - - - - - -
				MAC				xxx				xxx
				Bit Processor	Address ALU		xxx
				ALU				EA				Loop Exec.
		
			* pipelines (1.6E)
				Instruction Decode	(1i / c)
				- - - - - - - - - - - - - - - - - - - - - - - -
				MAC				Loop Exec.
				Bit Processor	Address ALU
				ALU				EA
	-->
	
	<stages>
		<stage id="F1">
			<name>F1</name>
			<width>1</width>
			<type>FETCH</type>
		</stage>
		<stage id="F2">
			<name>F2</name>
			<width>
				<xsl:if test="$core=0">1</xsl:if>
				<xsl:if test="$core!=0">3</xsl:if>
			</width>
			<type>LAZY</type>
		</stage>
		<stage id="EX">
			<name>E1</name>
			<width>
				<xsl:if test="$core=0">1</xsl:if>
				<xsl:if test="$core!=0">3</xsl:if>
			</width>
			<type>EXEC</type>
			<ordered>true</ordered>
			<fus>
				<fu id="INT">                       <!-- Integer pipeline -->
					<name>IP</name>
					<width>1</width>
					<latency>3</latency>
					<pipelined>true</pipelined>
				</fu>
				<xsl:if test="$core=1 or $core=2">
					<fu id="LP">                        <!-- Loop pipeline (missig in core E) -->
						<name>LP</name>
						<width>1</width>
						<latency>3</latency>
						<pipelined>true</pipelined>
					</fu>
				</xsl:if>
				<fu id="LS">                        <!-- Load/Store pipeline -->
					<name>LS</name>
					<width>1</width>
					<latency>3</latency>
					<pipelined>true</pipelined>
					<mem>true</mem>
				</fu>
				<fu id="FP">                        <!-- Float Point Unit pipeline -->
					<name>FP</name>
					<width>1</width>
					<latency>3</latency>
					<pipelined>true</pipelined>
				</fu>
			</fus>
			<dispatch>
				<inst>
					<type>0x80000000</type> <!-- IS_LP -->
					<xsl:if test="$core=0"><fu ref="LS"/></xsl:if>					
					<xsl:if test="$core=1 or $core=2"><fu ref="LP"/></xsl:if>
				</inst>
				<inst>
					<type>0x40000000</type>  <!-- IS_LS -->
					<fu ref="LS"/>
				</inst>
				<inst>
					<type>0x20000000</type>  <!-- IS_FP -->
					<fu ref="FP"/>
				</inst>
				<inst>
					<type></type>
					<fu ref="INT"/>
				</inst>
			</dispatch>
		</stage>
		<stage id="CM">
			<name>E2</name>		<!-- TODO rename CM -->
			<width>
				<xsl:if test="$core=0">1</xsl:if>
				<xsl:if test="$core!=0">3</xsl:if>
			</width>
			<type>COMMIT</type>
		</stage>
	</stages>
	<queues>
		<queue>
			<name>FETCH_QUEUE</name>
			<size>6</size>
			<input ref="F1"/>
			<output ref="F2"/>
		</queue>
	</queues>
</processor>
			


